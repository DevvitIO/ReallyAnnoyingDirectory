<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>(not so) Annoying website</title>
  <link rel="stylesheet" type="text/css" href="../stylesDirectory/amoutonbrady.css">
</head>

<body>
  <main class="main">
    <section class="section section--one">
      <div class="section__row">
        <p>This is</p>
      </div>
      <div class="section__row">
        <p>Perhaps</p>
      </div>
      <div class="section__row">
        <p>The most</p>
      </div>
      <div class="section__row">
        <p>Annoying</p>
      </div>
      <div class="section__row">
        <p>Website</p>
      </div>
      <div class="section__row">
        <p>Ever</p>
      </div>
    </section>

    <section class="section section--two">
      <h1 class="section__title">Here are some facts about me</h1>
      <div class="section__pop-up">
        <p>I'm Alexandre, 22 y.o, French ✌️</p>
      </div>
      <div class="section__pop-up">
        <p>My favorite language is Javascript</p>
      </div>
      <div class="section__pop-up">
        <p>Web developpement & Photography 📷 are my two passions</p>
      </div>
      <div class="section__pop-up">
        <p>My favorite kind of music is original soundtracks from movies & video games 🎼</p>
      </div>
      <div class="section__pop-up">
        <p> Best movie ever is Jurassic Park 🎥</p>
      </div>
      <div class="section__pop-up">
        <p>I crave meringue lemon pie 🍋</p>
      </div>
      <div class="section__pop-up">
        <p>Huge League of Legends player 🎮</p>
      </div>
      <div class="section__pop-up">
        <p>Would love to learn to set up Arch 💻</p>
      </div>
      <div class="section__pop-up">
        <p>Proud owner of a Cane Corso 🐶</p>
      </div>
      <div class="section__pop-up">
        <p>Someone mentioned BMX? It used to be my drug 🚲</p>
      </div>
      <div class="section__pop-up">
        <p>Despite being French, I prefer English</p>
      </div>
      <div class="section__pop-up">
        <p>My dream destination would be Northen Europe (Sweden specifically) ✈️</p>
      </div>
      <div class="section__pop-up">
        <p>Probably more to come!</p>
      </div>
      <div class="section__pop-up section__pop-up--replay">
        <button id="replay">
          Couldn't read everything?
          <br> Go ahead and
          <strong>click me</strong> to replay the animation 😋
          <br>
          <br> Otherwise,
          <strong>scroll down</strong> to get back to the directory
        </button>
      </div>
    </section>
  </main>

  <footer class="footer">
    <a href="https://learndevelopmentpublic.github.io/ReallyAnnoyingDirectory/">
      ⬅️ Get back to the directory
    </a>
  </footer>

  <div class="transition transition--start"></div>

  <script src="https://cdn.jsdelivr.net/npm/animejs@2.2.0/anime.min.js"></script>
  <script>
    // State the contains crucial datas
    // Could be vastly improved
    const state = {
      VW: window.innerWidth,
      VH: window.innerHeight,
      firstPart: anime.timeline({ autoplay: false }),
      menuVisible: false
    }

    /* jQuery like function to retrieve DOM element(s)
     * with the simple $ alias shortcut
    **/
    function $(search) {
      const node = document.querySelectorAll(search);

      if (node.length > 1) return node;

      return document.querySelector(search);
    }

    /* Initiate the replay of the animation by:
     * #1: removing the possibility the show the menu during the animation
     * #2: creating a new timeline
     * #3: hiding the menu if open
     * #4: fading the second section out, leaving a blank canvas
     * #5: once finished, restart the animation
    **/
    function handleClick(tl) {
      $('.footer').removeEventListener('wheel', showMenu);

      const out = anime.timeline();

      out
        .add({
          targets: '.footer',
          duration: 300,
          translateY: 0
        })
        .add({
          targets: '.section--two',
          opacity: [1, 0],
          duration: 600,
        })

      out.finished.then(tl.restart);
    }

    /* Function performed on scroll to show/hide
     * the menu to come back the main directory
    **/
    function showMenu(e) {
      // Height needed to show the menu
      const footerHeight = $('.footer').offsetHeight;

      // If scroll is down
      if (e.deltaY > 0) {
        // And menu is not already shown
        if (state.menuVisible) return;

        // Animate it
        anime({
          targets: '.footer',
          duration: 300,
          translateY: -footerHeight,
        });

        // And tell the global state that it's shown
        state.menuVisible = true;
      } else {
        // else if scroll up and not already hidden
        if (!state.menuVisible) return;

        // Animate it
        anime({
          targets: '.footer',
          duration: 300,
          translateY: 0,
        });

        // And tell the global state that it's hidden
        state.menuVisible = false;
      }
    }

    // Bootstrap of the page
    function init() {
      /* Description of the whole animations
      * #1: animate the rows one by one
      * #2: animate the circle from the middle that acts like a transition
      * #3: fade-in the title of the second section
      * #4: make the title blink then disappear
      * #5: make every popup show up at random place
      **/
      state.firstPart
        .add({ // #1
          targets: '.section__row',
          opacity: [0, 1],
          translateX: ['100%', 0],
          delay: (el, i, l) => i * 300,
          duration: 1500
        })
        .add({ // #2
          targets: '.transition--start',
          opacity: [0, 1],
          scale: [0, 1],
          duration: 1000,
          delay: 500,
          easing: 'easeOutBack'
        })
        .add({ // #3
          targets: '.section--two',
          opacity: [0, 1],
          duration: 300,
          offset: '-=800'
        })
        .add({ // #4
          targets: '.section__title',
          easing: 'easeInOutBack',
          opacity: [
            { value: 0, duration: 75 },
            { value: 1, duration: 75 },
            { value: 0, duration: 90 },
            { value: 1, duration: 90 },
            { value: 0, duration: 110 },
            { value: 1, duration: 110 },
            { value: 0, duration: 150 },
            { value: 1, duration: 150 },
            { value: 0, duration: 200 },
          ],
          delay: 300
        })
        .add({ // #5
          targets: '.section__pop-up',
          opacity: [0, 1],
          scale: [1.5, 1],
          duration: 600,
          translateX: (el) => Math.random() * ((state.VW - el.offsetWidth) - 0),
          translateY: (el) => Math.random() * ((state.VH - el.offsetHeight) - 0),
          delay: (el, i) => i * 800,
        });

      // Add the showMenu capabilities
      window.addEventListener('wheel', showMenu);

      // Add the replay capabilities
      $('#replay').addEventListener('click', () => {
        handleClick(state.firstPart);
      });

      // Delay the timeline by a few ms to produce a smooth start
      setTimeout(() => {
        state.firstPart.play();
      }, 500)
    }

    // Start the init function want the DOM finished loading
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>
